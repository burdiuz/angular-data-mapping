!function(){function EntityService(){EntityServiceSharedInterface.apply(this),this.create=function(t,n,e,r){var i=this.get(t,r);return createEntity(n,i,e)},this.createNew=function(t,n){var e=this.get(t,n);return new e},this.factory=function(t,n,e){var r=this;return function(i){return r.create(t,i,n,e)}},this.verify=function(t){return typeMaps.verify(t)}}function EntityServiceSharedInterface(){this.extend=extend,this.isEntity=isEntity,this.isEntityClass=isEntityClass,this.get=getType,this.getNamespace=getNamespace}function addType(t,n,e){t instanceof QNameEntity&&(e=t.uri,t=t.localName),isEntityClass(n)||(n=extend(n)),getNamespace(e).add(t,n)}function getType(t,n){return t instanceof QNameEntity&&(n=t.uri,t=t.localName),getNamespace(n).get(t)}function getNamespace(t){var n;return t=t||defaultNamespace,namespaces.hasOwnProperty(t)?n=namespaces[t]:namespaces[t]=n=new EntityNamespace(t),n}function createEntity(data,constructor,entityTypeMap){var instance;if(constructor)"function"!=typeof constructor&&(constructor=getType(constructor));else if(data instanceof Entity)constructor=data.constructor||data.__proto__.constructor;else if("$constructor"in data&&data.$constructor)try{eval("constructor = window."+data.$constructor)}catch(error){throw console.log(error),new Error('Entity class "'+data.$constructor+'" is not defined.')}return constructor?isEntityClass(constructor)||(constructor=extend(constructor)):constructor=Entity,instance=new constructor,typeMaps.create(instance),data&&instance.apply(data,entityTypeMap),instance}function extend(t){return t.prototype=new Entity,t.prototype.constructor=t,t}function isEntity(t,n){return n?t instanceof getType(n):t instanceof Entity}function isEntityClass(t){return t instanceof Function&&(t===Entity||Entity.prototype.isPrototypeOf(t.prototype))}function Dictionary(){var t,n;this.add=function(e,r){if(e!==e)throw new Error("Key cannot be NaN.");if(this.has(e))throw new Error("Key must be unique.");t.push(e),n.push(r)},this.get=function(e){var r=t.indexOf(e);return r>=0?n[r]:null},this.getFirstKey=function(e){var r=n.indexOf(e);return r>=0?t[r]:null},this.getAllKeys=function(e){for(var r=[],i=0;(i=n.indexOf(e,i))>=0;)r.push(t[i]),i++;return r},this.has=function(n){return t.indexOf(n)>=0},this.remove=function(e){var r=t.indexOf(e);r>=0&&(t.splice(r,1),n.splice(r,1))},this.clear=function(){t=[],n=[]},Object.defineProperty(this,"length",{get:function(){return t.length}}),this.clear()}function EntityNamespace(t){t=t?String(t):"";var n={};Object.defineProperty(this,"name",{value:t,writable:!1,enumerable:!0}),this.add=function(t,e){if(n.hasOwnProperty(t))throw new Error('EntityNamespace "'+this.name+'" already has entity with name "'+t+'".');if("function"!=typeof e)throw new Error("EntityNamespace#add requires second parameter to be Entity constructor function.");n[t]=e},this.get=function(t){var e;if(n.hasOwnProperty(t)&&n[t]instanceof Function)e=n[t];else{if(!defaultType)throw new Error('EntityNamespace "'+this.name+'" does not have entity with name "'+t+'".');e=defaultType}return e}}function EntityMaps(){function t(t){return t.constructor instanceof Function?t.constructor:t.__proto__.constructor}var n=new Dictionary;this.create=function(e,r){var i,o=t(e);if(i=n.get(o),!i){i={};for(var a in e)if(e.hasOwnProperty(a)&&"function"!=typeof e[a])if(r&&r.hasOwnProperty(a))i[a]=r[a];else{var c=e[a];void 0!==c&&null!==c&&(i[a]=c.constructor instanceof Function&&c instanceof c.constructor?c.constructor:typeof c)}n.add(o,i)}return i},this.has=function(e){return n.has(t(e))},this.hasDefinition=function(t){return n.has(t)},this.verify=function(e){var r=n.get(t(e));if(!r)return void 0;var i=!0;for(var o in r)if(r.hasOwnProperty(o)){var a=e[o],c=r[o];if(i="string"==typeof c?typeof a==c:void 0!==a&&null!==a&&a.constructor?a.constructor===c:a instanceof c,!i)break}return i}}function Entity(){this.property=function(t,n,e,r){function i(){throw new Error('Property "'+t+'" is read only and cannot be changed.')}function o(t){n=t}function a(e){if(typeof e!=r)throw new Error('Property "'+t+'" value must be of "'+r+'" type, "'+typeof e+'" passed.');n=e}function c(e){if(!(e instanceof r))throw new Error('Property "'+t+'" new value of wrong type.');n=e}if("undefined"==typeof n&&!r)throw new Error("Property must have a default value ot type defined to determine its type.");r||(r=n.constructor instanceof Function&&n instanceof n.constructor?n.constructor:typeof n);var s={get:function(){return n},enumerable:!0};s.set=e?i:"string"==typeof r?a:r?c:o,Object.defineProperty(this,t,s)},this.apply=function(t,n){function e(t,n){var e;return t&&"object"==typeof t&&(e=t instanceof Array?i(t,n):t instanceof Entity?t.copy():r(t,n)),e||t}function r(t,n){var e;return n?((n instanceof QNameEntity||"string"==typeof n)&&(n=getType(n)),e="function"==typeof n?createEntity(t,n):createEntity(t,n.constructor,n)):e=createEntity(t),e}function i(t,n){var r,i=[],o=t.length;for(r=0;o>r;r++)i[r]=e(t[r],n);return i}var o;for(o in t)t.hasOwnProperty(o)&&(this[o]instanceof Entity?this[o].apply(t[o],n&&n.hasOwnProperty(o)?n[o]:null):this[o]=e(t[o],n&&n.hasOwnProperty(o)?n[o]:null))},this.copy=function(){function t(t){var e=t;return t&&"object"==typeof t&&(e=t instanceof Array?n(t):t instanceof Entity?t.copy():angular.copy(t)),e}function n(n){var e,r=[],i=n.length;for(e=0;i>e;e++)r[e]=t(n[e]);return r}var e,r,i=new(this.constructor||this.__proto__.constructor);for(e in this)if(this.hasOwnProperty(e)){if(r=this[e],"function"==typeof r)continue;i[e]=t(r)}return i},this.valueOf=function(t,n){function e(t,n,e){var o;return o=n>=0&&t&&"object"==typeof t?t instanceof Array?r(t,n?n-1:0,e):i(t,n?n-1:0,e):t}function r(t,n,r){var i,o=[],a=t.length;for(i=0;a>i;i++)o[i]=e(t[i],n,r);return o}function i(t,n,e){var r,i=c.indexOf(t);return i>=0?r=s[i]:(c.push(t),r="valueOf"in t&&t.valueOf instanceof Function?t instanceof Entity?t.valueOf(n,e):t.valueOf():t,s[i]=r),r}isNaN(t)&&(t=0);var o,a,c=[],s=[],u={};for(o in this)if(a=this[o],"function"!=typeof a){if(n&&(""===a||null===a||void 0===a))continue;u[o]=e(this[o],t,n)}return u}}function QNameEntity(t,n){this.localName=void 0===t?"":String(t),this.uri=void 0===n?"":String(n)}var module=angular.module("aw.datamapping",[]);module.provider("entityService",function(){EntityServiceSharedInterface.apply(this),this.register=function(t,n,e){addType(t,n,e)},this.setDefaultType=function(t){defaultType=t},this.setDefaultNamespace=function(t){defaultNamespace=t||""},this.$get=function(){return new EntityService}});var namespaces={},defaultType=null,defaultNamespace="",typeMaps=new EntityMaps;window.Entity=Entity,module.config(["entityServiceProvider",function(t){t.register("Entity",Entity),t.register("QName",QNameEntity)}])}();